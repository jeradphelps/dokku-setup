APPLICATION_ROOT=$1
HOSTNAME=$2
REMOTE_IP_ADDRESS=$3

GIT_REMOTE_NAME=$HOSTNAME"prod"
APP_NAME=$HOSTNAME".com"

echo "//////////////////////////////////////////"
echo "//////////////////////////////////////////"
echo "//////////////////////////////////////////"
echo "copy environment vars to our server"
echo "//////////////////////////////////////////"
echo "//////////////////////////////////////////"
echo "//////////////////////////////////////////"
scp ./my_configs root@$REMOTE_IP_ADDRESS:/home/dokku/$APP_NAME/ENV



echo "//////////////////////////////////////////"
echo "//////////////////////////////////////////"
echo "//////////////////////////////////////////"
echo "re-deploy to utilize config vars"
echo "//////////////////////////////////////////"
echo "//////////////////////////////////////////"
echo "//////////////////////////////////////////"
# Push it real good. 
cd $APPLICATION_ROOT
git push $GIT_REMOTE_NAME master


echo "//////////////////////////////////////////"
echo "//////////////////////////////////////////"
echo "//////////////////////////////////////////"
echo "setting domains"
echo "//////////////////////////////////////////"
echo "//////////////////////////////////////////"
echo "//////////////////////////////////////////"

# set our domains using the domain plugin
# NOTE do not ssh to the server and run this as root.
ssh dokku@$REMOTE_IP_ADDRESS domains:set $APP_NAME www.$APP_NAME


